#define module #p4#
#define key #p5#
#define velocity #p6#

#define plug(signal) #midinoteonkey $key, $velocity

SModule = $module

$signal oPlug SModule#

opcode oPlug, a, So

SModule, iDefault xin

if iDefault == -1 then

SLinkedModule = SModule

iLinkedModule oGet SLinkedModule

else

iLinkedModule, SLinkedModule oLinked SModule

endif

if iLinkedModule > 0 then

aOutput subinstr iLinkedModule, SLinkedModule, $key, $velocity

else

aOutput init iDefault

endif

xout aOutput

endop
